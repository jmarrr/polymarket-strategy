<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polymarket Sniper Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            min-height: 100vh;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
        }
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        .header .updated {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        .config-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.85rem;
        }
        .config-item {
            background: rgba(255,255,255,0.15);
            padding: 5px 15px;
            border-radius: 20px;
        }
        .section {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .section h2 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #2a2a4a;
        }
        th {
            background: #0f3460;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        .price {
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }
        .price-hit {
            color: #4ade80;
            background: rgba(74, 222, 128, 0.15);
            padding: 3px 8px;
            border-radius: 4px;
        }
        .price-low {
            color: #94a3b8;
        }
        .timer {
            font-family: 'Courier New', monospace;
            color: #fbbf24;
        }
        .timer-urgent {
            color: #ef4444;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .status-sniped {
            color: #4ade80;
            font-weight: 600;
        }
        .status-monitoring {
            color: #60a5fa;
        }
        .status-warming {
            color: #fbbf24;
        }
        .status-stale {
            color: #ef4444;
        }
        .trade-success {
            color: #4ade80;
        }
        .trade-failed {
            color: #ef4444;
        }
        .error-row {
            color: #fbbf24;
            font-size: 0.9rem;
        }
        .error-row td:last-child {
            word-break: break-word;
            max-width: 500px;
        }
        .empty-message {
            text-align: center;
            color: #64748b;
            padding: 20px;
            font-style: italic;
        }
        .liquidity {
            color: #94a3b8;
            font-size: 0.85rem;
        }
        @media (max-width: 768px) {
            body { padding: 10px; }
            th, td { padding: 8px 10px; font-size: 0.85rem; }
            .config-bar { flex-wrap: wrap; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Polymarket Sniper Dashboard</h1>
        <div class="updated" id="updated">Loading...</div>
        <div class="config-bar" id="config-bar"></div>
    </div>

    <div class="section">
        <h2>Live Asset Prices</h2>
        <table>
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Timer</th>
                    <th>Target</th>
                    <th>UP Price</th>
                    <th>DOWN Price</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="assets-table">
                <tr><td colspan="6" class="empty-message">Connecting...</td></tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Recent Trades</h2>
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Asset</th>
                    <th>Side</th>
                    <th>Price</th>
                    <th>Size</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody id="trades-table">
                <tr><td colspan="6" class="empty-message">No trades yet</td></tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2>Error Log</h2>
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Asset</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody id="errors-table">
                <tr><td colspan="3" class="empty-message">No errors</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        function formatPrice(price, target) {
            const isHit = price >= target - 0.005;
            const cls = isHit ? 'price price-hit' : 'price price-low';
            return `<span class="${cls}">$${price.toFixed(2)}</span>`;
        }

        function formatPriceWithSize(price, size, target) {
            const isHit = price >= target - 0.005;
            const cls = isHit ? 'price price-hit' : 'price price-low';
            return `<span class="${cls}">$${price.toFixed(2)}</span> <span class="liquidity">(${size})</span>`;
        }

        function formatTimer(timer) {
            const parts = timer.split(':');
            const mins = parseInt(parts[0]);
            const isUrgent = mins < 1;
            const cls = isUrgent ? 'timer timer-urgent' : 'timer';
            return `<span class="${cls}">${timer}</span>`;
        }

        function formatStatus(status) {
            const statusMap = {
                'sniped': ['SNIPED', 'status-sniped'],
                'monitoring': ['Monitoring', 'status-monitoring'],
                'warming': ['Warming Up', 'status-warming'],
                'stale': ['Stale Data', 'status-stale'],
                'cooldown': ['Cooldown', 'status-stale']
            };
            const [text, cls] = statusMap[status] || [status, ''];
            return `<span class="${cls}">${text}</span>`;
        }

        function updateDashboard(data) {
            // Update timestamp
            document.getElementById('updated').textContent = `Last updated: ${data.updated || 'N/A'}`;

            // Update config bar
            if (data.config) {
                const configBar = document.getElementById('config-bar');
                configBar.innerHTML = `
                    <span class="config-item">Trading: ${data.config.execute_trades ? 'ENABLED' : 'DISABLED'}</span>
                    <span class="config-item">Max Position: $${data.config.max_position}</span>
                    <span class="config-item">Max Exposure: $${data.config.max_exposure}</span>
                    <span class="config-item">Auto-snipe: ${data.config.auto_snipe ? 'ON' : 'OFF'}</span>
                `;
            }

            // Update assets table
            const assetsTable = document.getElementById('assets-table');
            const assets = data.assets || {};
            if (Object.keys(assets).length === 0) {
                assetsTable.innerHTML = '<tr><td colspan="6" class="empty-message">Waiting for data...</td></tr>';
            } else {
                assetsTable.innerHTML = Object.entries(assets)
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .map(([name, asset]) => `
                        <tr>
                            <td><strong>${name}</strong></td>
                            <td>${formatTimer(asset.timer)}</td>
                            <td class="price">$${asset.target.toFixed(2)}</td>
                            <td>${formatPriceWithSize(asset.up_price, asset.up_size, asset.target)}</td>
                            <td>${formatPriceWithSize(asset.down_price, asset.down_size, asset.target)}</td>
                            <td>${formatStatus(asset.status)}</td>
                        </tr>
                    `).join('');
            }

            // Update trades table
            const tradesTable = document.getElementById('trades-table');
            const trades = data.trades || [];
            if (trades.length === 0) {
                tradesTable.innerHTML = '<tr><td colspan="6" class="empty-message">No trades yet</td></tr>';
            } else {
                tradesTable.innerHTML = trades.map(trade => `
                    <tr>
                        <td>${trade.time}</td>
                        <td><strong>${trade.asset}</strong></td>
                        <td>${trade.side}</td>
                        <td class="price">$${trade.price.toFixed(2)}</td>
                        <td>${trade.size} shares</td>
                        <td class="${trade.success ? 'trade-success' : 'trade-failed'}">
                            ${trade.success ? 'SUCCESS' : 'FAILED'}
                        </td>
                    </tr>
                `).join('');
            }

            // Update errors table
            const errorsTable = document.getElementById('errors-table');
            const errors = data.errors || [];
            if (errors.length === 0) {
                errorsTable.innerHTML = '<tr><td colspan="3" class="empty-message">No errors</td></tr>';
            } else {
                errorsTable.innerHTML = errors.map(error => `
                    <tr class="error-row">
                        <td>${error.time}</td>
                        <td><strong>${error.asset}</strong></td>
                        <td>${error.message}</td>
                    </tr>
                `).join('');
            }
        }

        async function fetchStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Failed to fetch status:', error);
            }
        }

        // Initial fetch
        fetchStatus();

        // Refresh every 2 seconds
        setInterval(fetchStatus, 2000);
    </script>
</body>
</html>
